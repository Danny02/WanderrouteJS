<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>Three.JS.GPUGPU</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

		<style>
			body {
				background-color: #000;
				margin: 0px;
				overflow: hidden;
			}
		</style>

	</head>

	<body>
		<script type="x-shader/x-vertex" id="customVertexshader">
		    // switch on high precision floats
		    #ifdef GL_ES
		    precision highp float;
		    #endif
		    varying vec3 texcoords;
		    varying float ambient;

		    uniform float time;
		    void main(){
		    	ambient = normal.x;
		        vec3 pos = position;
		        pos.z *= pow(min(time/3., 1.),1.);

		        texcoords = pos+0.5;
		        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos,1.0);
		    }
		</script>
		<script type="x-shader/x-fragment" id="customFragmentshader">
		    #ifdef GL_ES
		        precision highp float;
		    #endif
		    #define COLOR255(x,y,z) vec3(x/255., y/255., z/255.)

		    uniform  sampler2D normal;
		    varying vec3 texcoords;
		    varying float ambient;

		    const vec3 light1 = vec3(0.12708472893924555, 
		                             0.5399460893115735,
		                             0.6320502943377743);

		    const vec3 blue = COLOR255(148.,193.,255.);
		    const vec3 orange = COLOR255(255.,179.,102.);

	
			float cubicPulse( float c, float w, float x )
			{
			    x = abs(x - c);
			    if( x>w ) return 0.;
			    x /= w;
			    return 1. - x*x*(3.-2.*x);
			}

		    void main(){
		        vec3 N = texture2D(normal, texcoords.xy).xyz;
		        N.xy = N.xy*2.-1.;
		        N.z *= .2;
		        N = normalize(N);

		        vec3 color = vec3(0.);

		        vec3 L1 = normalize(light1);
		        color += dot(N, L1) * blue * 0.5;
		        vec3 L2 = reflect(L1, vec3(0.,1.,0.));
		        color += dot(N, L2) * orange * 0.7;

		        float a = ambient*3.3;
		        a = abs(a - 1.);
		        a = 1. - a*a*(3.-2.*a);
		        color *= a;

		        gl_FragColor = vec4(color, 1.);
		    }
		</script>

		<script src="includes/Three.js"></script>
		<script src="includes/ctm.js"></script>
		<script src="includes/CTMLoader.js"></script>
		<script src="includes/lzma.js"></script>
		<script src="includes/main.js"></script>
	</body>

</html>